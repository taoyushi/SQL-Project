# configs/self_correction_config_qwen3.yaml
# 针对qwen3:14b模型的配置文件

# --- LLM API设置 ---
llm_settings:
  # API密钥
  api_key: "sk-Kj3#zA5sD7fG9hJ=1kL3nQ"
  
  # API端点 - 自部署的OpenAI兼容API
  api_endpoint: "http://qilc.top:58000/v1/chat/completions"
  
  # 模型名称
  model_name: "qwen3:14b"
  
  # 生成参数
  temperature: 0.1          # 较低的温度值以获得更确定性的输出
  max_tokens: 800          # 增加token数量以适应14b模型的能力
  timeout_seconds: 120     # 增加超时时间以适应可能的网络延迟
  max_retries: 5           # 增加重试次数以提高稳定性
  
  # 停止序列
  stop_sequences:
    - "#;\n\n"
    - "\n\n---"
    - "---\n"

# --- Prompt设置 ---
prompt_settings:
  # Prompt模板 - 针对qwen3模型优化
  templates:
    generic: |
      You are an expert SQL developer. Your task is to review and correct SQL queries generated from natural language questions.

      Given:
      - A natural language question
      - Database schema information
      - An initial SQL query that may contain errors

      Your goal: Provide a corrected SQL query that accurately answers the question based on the schema.

      Instructions:
      1. If the initial SQL is correct, return it unchanged
      2. If incorrect, identify and fix the errors
      3. Ensure the corrected SQL follows proper syntax and logic
      4. Use the exact table and column names from the schema

      Schema:
      {schema_context}

      Question: {nlq}
      Initial SQL: {initial_sql}
      Hint: {hint}

      Please provide the corrected SQL:

    guided: |
      You are an expert SQL developer. Your task is to review and correct SQL queries generated from natural language questions.

      Given:
      - A natural language question
      - Database schema information  
      - An initial SQL query that may contain errors
      - A specific hint about potential issues

      Your goal: Provide a corrected SQL query that accurately answers the question based on the schema.

      Pay special attention to the hint provided, which identifies specific issues found during validation.

      Schema:
      {schema_context}

      Question: {nlq}
      Initial SQL: {initial_sql}
      
      Important Hint: {hint}

      Based on the hint and schema, please provide the corrected SQL:

  # Few-shot示例 - 针对qwen3模型优化
  few_shot_examples:
    - question: "Find all cities with population greater than 1 million."
      schema_text: |
        TABLE city (
          city_id INT PRIMARY KEY,
          city_name VARCHAR,
          state VARCHAR,
          country VARCHAR,
          population INT,
          area DECIMAL
        );
      initial_sql: "SELECT Name FROM city WHERE Population > 1000000"
      hint: "Column name 'Name' does not exist. The correct column name is 'city_name'."
      correct_sql: "SELECT city_name FROM city WHERE population > 1000000"
      
    - question: "Count employees in the Sales department."
      schema_text: |
        TABLE employee (
          emp_id INT PRIMARY KEY,
          emp_name VARCHAR,
          dept_id INT
        );
        TABLE department (
          dept_id INT PRIMARY KEY,
          dept_name VARCHAR
        );
        Foreign Keys:
        - employee.dept_id references department.dept_id
      initial_sql: "SELECT count(*) FROM employee WHERE dept_name = 'Sales'"
      hint: "Missing JOIN with department table to access dept_name column."
      correct_sql: "SELECT count(*) FROM employee e JOIN department d ON e.dept_id = d.dept_id WHERE d.dept_name = 'Sales'"

    - question: "What is the average salary of teachers?"
      schema_text: |
        TABLE person (
          id INT PRIMARY KEY,
          name VARCHAR,
          job VARCHAR,
          salary DECIMAL
        );
      initial_sql: "SELECT avg(salary) FROM person WHERE job = 'teacher'"
      hint: "The job value 'teacher' might not match the exact case in database. Use proper case matching."
      correct_sql: "SELECT avg(salary) FROM person WHERE job = 'Teacher'"

# --- 日志设置 ---
logging_settings:
  # 日志保存目录
  log_dir: "./correction_logs_qwen3"